"use strict";(self.webpackChunkoauth_frontend=self.webpackChunkoauth_frontend||[]).push([[420],{22418:function(e,n,r){r.d(n,{Z:function(){return C}});var t=r(74165),s=r(93433),c=r(15861),i=r(29439),o=r(36459),a=r(52982),u=r(93241),l=r(65700),d=r(92681),h=r(1396),x=r(47313),p=r(1200),f=r(79267),m=r(74200),j=r(14707),b=r(92293),v=r(97939),k=r(65059),Z=r(65508),g=r(88910),_=r(46417),w=function(e){var n=e.user,r=e.clickedBgColor,t=e.size,s=void 0===t?"sm":t,c=e.onClick,i=e.onRemove,o=e.externalLink,a=void 0===o||o,u="function"===typeof c,l="5";return"xs"===s&&(l="0"),"sm"===s&&(l="3"),(0,_.jsx)(m.Z,{onClick:function(){"function"===typeof c&&c(n)},style:u?{cursor:"pointer"}:{},bgColor:r,children:(0,_.jsx)(j.O,{p:l,children:(0,_.jsxs)(h.k,{children:[(0,_.jsxs)(h.k,{flex:"1",gap:"4",alignItems:"center",flexWrap:"wrap",children:[(0,_.jsx)(b.q,{name:n.login,src:n.avatar_url,size:s}),(0,_.jsx)(v.xu,{mr:1,children:(0,_.jsx)(k.X,{size:s,children:n.login})})]}),a&&(0,_.jsx)(Z.r,{href:n.html_url,isExternal:!0,children:(0,_.jsx)(g.h,{variant:"ghost",colorScheme:"gray","aria-label":"Profile",icon:(0,_.jsx)(p.h,{}),size:s})}),i&&(0,_.jsx)(g.h,{onClick:function(){"function"===typeof i&&i(n)},variant:"ghost",colorScheme:"red","aria-label":"Profile",icon:(0,_.jsx)(f.p,{}),size:s})]})})})},S=r(75590),C=function(e){var n=Object.assign({},((0,o.Z)(e),e)),r=(0,a.p)(),p=(0,S.$G)().t,f=(0,x.useState)(""),m=(0,i.Z)(f,2),j=m[0],b=m[1],v=(0,x.useState)(null),k=(0,i.Z)(v,2),Z=k[0],g=k[1],C=(0,x.useState)([]),y=(0,i.Z)(C,2),z=y[0],T=y[1],U=(0,x.useState)([]),I=(0,i.Z)(U,2),E=I[0],O=I[1];(0,x.useEffect)((function(){Z&&clearTimeout(Z),g(setTimeout(L,500))}),[j]),(0,x.useEffect)((function(){"function"===typeof n.onUpdateSelection&&n.onUpdateSelection(E)}),[E]);var L=function(){var e=(0,c.Z)((0,t.Z)().mark((function e(){var n,c,i,o;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T([]),j){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,n=[],e.next=7,fetch("https://api.github.com/search/users?q=".concat(j));case 7:return c=e.sent,e.next=10,c.json();case 10:return(i=e.sent).items.length>0&&n.push.apply(n,(0,s.Z)(i.items)),e.next=14,fetch("https://api.github.com/orgs/".concat(j,"/public_members"));case 14:return c=e.sent,e.next=17,c.json();case 17:(i=e.sent).length>0&&n.push.apply(n,(0,s.Z)(i)),o=n.filter((function(e,n,r){return r.findIndex((function(n){return n.id===e.id}))===n})),T(o),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(3),console.error("Error fetching users:",e.t0),r({title:p("csp_census.github.error_fetching_users"),status:"error",duration:5e3,isClosable:!0});case 27:case"end":return e.stop()}}),e,null,[[3,23]])})));return function(){return e.apply(this,arguments)}}(),q=function(e){E.includes(e)?O((function(n){return n.filter((function(n){return n.id!==e.id}))})):O((function(n){return[].concat((0,s.Z)(n),[e])}))},A=function(e){O((function(n){return n.filter((function(n){return n.id!==e.id}))}))};return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(u.I,{type:"text",placeholder:"Search...",onChange:function(e){return n=e.target.value,void b(n);var n}}),z&&z.length>0&&(0,_.jsx)(l.aV,{spacing:2,maxH:500,overflow:"scroll",children:z.map((function(e){return(0,_.jsx)(l.HC,{style:{listStyleType:"none"},children:(0,_.jsx)(w,{size:"sm",user:e,onClick:q,clickedBgColor:E.includes(e)?"teal.100":"transparent"})},e.id)}))}),n.showSelectedList&&E.length>0&&(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(d.l,{mt:8,children:p("csp_census.github.selected_users")}),(0,_.jsx)(l.aV,{children:(0,_.jsx)(h.k,{children:E.map((function(e){return(0,_.jsx)(l.HC,{mr:2,children:(0,_.jsx)(w,{user:e,size:"xs",onRemove:A,externalLink:!1})},e.id)}))})})]})]})}},75420:function(e,n,r){r.r(n);var t=r(1413),s=r(74165),c=r(15861),i=r(29439),o=r(58467),a=r(83871),u=r(47313),l=r(89097),d=r(52982),h=r(97939),x=r(1396),p=r(65059),f=r(67727),m=r(22190),j=r(58816),b=r(12046),v=r(71433),k=r(39346),Z=r(79976),g=r(4451),_=r(16442),w=r(26998),S=r(24128),C=r(93241),y=r(96653),z=r(53503),T=r(56360),U=r(27094),I=r(5521),E=r(65549),O=r(41237),L=r(23216),q=r(88910),A=r(92167),B=r(83757),F=r(76244),H=r(19134),P=r(50855),R=r(79267),V=r(7410),X=r(22418),G=r(34102),J=r(75590),N=r(46417);n.default=function(){var e=(0,o.UO)().id,n=(0,a.YX)(),r=n.vocdoniAdminClient,W=n.getAdminToken,$=(0,o.s0)(),D=(0,l.q)(),Y=D.isOpen,K=D.onOpen,M=D.onClose,Q=(0,G.m8)().client,ee=(0,d.p)(),ne=(0,J.$G)().t,re=(0,u.useState)(""),te=(0,i.Z)(re,2),se=te[0],ce=te[1],ie=(0,u.useState)(),oe=(0,i.Z)(ie,2),ae=oe[0],ue=oe[1],le=(0,u.useState)([]),de=(0,i.Z)(le,2),he=de[0],xe=de[1],pe=(0,u.useState)(!1),fe=(0,i.Z)(pe,2),me=fe[0],je=fe[1];(0,u.useEffect)((function(){!function(){var n=(0,c.Z)((0,s.Z)().mark((function n(){var t;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&Q&&e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,W(e);case 4:if((t=n.sent)||(ee({title:ne("form.process.error_csp_permissions"),status:"error",duration:5e3,isClosable:!0}),$("/")),ce(t),ae){n.next=20;break}return n.prev=8,n.t0=ue,n.next=12,Q.fetchElection(e);case 12:n.t1=n.sent,(0,n.t0)(n.t1),n.next=20;break;case 16:n.prev=16,n.t2=n.catch(8),ee({title:ne("form.process.error_fetching_election"),status:"error",duration:5e3,isClosable:!0}),$("/");case 20:be();case 21:case"end":return n.stop()}}),n,null,[[8,16]])})));return function(){return n.apply(this,arguments)}}()()}),[r,Q,se,e]);var be=function(){var n=(0,c.Z)((0,s.Z)().mark((function n(){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&se){n.next=2;break}return n.abrupt("return");case 2:return n.t0=xe,n.next=5,r.cspUserList(se,e);case 5:if(n.t1=n.sent,n.t1){n.next=8;break}n.t1=[];case 8:n.t2=n.t1,(0,n.t0)(n.t2);case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),ve=function(n){return(0,c.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&se){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,r.cspUserDelete(se,e,n);case 4:be();case 5:case"end":return t.stop()}}),t)})))},ke=function(){var n=(0,c.Z)((0,s.Z)().mark((function n(t,c){var i;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&se){n.next=2;break}return n.abrupt("return");case 2:return je(!0),n.next=5,r.cspUserSearch(se,e,{data:t.search});case 5:i=n.sent,xe(i||[]);case 7:case"end":return n.stop()}}),n)})));return function(e,r){return n.apply(this,arguments)}}(),Ze=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:be(),je(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ge=function(){var n=(0,c.Z)((0,s.Z)().mark((function n(t){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&se){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,Promise.all(t.map(function(){var n=(0,c.Z)((0,s.Z)().mark((function n(t){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.cspUserCreate(se,e,{handler:"oauth",service:"github",mode:"usernames",data:t.login,consumed:!1});case 3:n.next=8;break;case 5:n.prev=5,n.t0=n.catch(0),console.log(n.t0);case 8:case"end":return n.stop()}}),n,null,[[0,5]])})));return function(e){return n.apply(this,arguments)}}()));case 4:be();case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,N.jsxs)(h.xu,{rounded:"lg",bgColor:"white",boxShadow:"lg",p:[4,8],pt:[4,6],children:[ae&&(0,N.jsxs)(x.k,{justify:"space-between",children:[(0,N.jsxs)(h.xu,{children:[(0,N.jsx)(p.X,{mb:5,children:null===ae||void 0===ae?void 0:ae.title.default}),(0,N.jsx)(h.xu,{mb:7,children:(0,N.jsx)("p",{children:null===ae||void 0===ae?void 0:ae.description.default})})]}),(0,N.jsx)(h.xu,{children:(0,N.jsx)(G.qT,{election:ae,autoUpdate:!0,children:(0,N.jsx)(G.A2,{})})})]}),(0,N.jsxs)(x.k,{mt:5,gap:2,children:[(0,N.jsxs)(f.z,{onClick:K,children:[(0,N.jsx)(A.d,{boxSize:3,color:"blue.500",mr:2}),ne("csp_census.add_users")]}),(0,N.jsxs)(m.u_,{isOpen:Y,onClose:M,children:[(0,N.jsx)(j.Z,{}),(0,N.jsxs)(b.h,{children:[(0,N.jsx)(v.x,{children:ne("csp_census.modal.title")}),(0,N.jsx)(k.o,{}),(0,N.jsx)(Z.f,{children:(0,N.jsx)(X.Z,{onUpdateSelection:ge})}),(0,N.jsx)(g.m,{children:(0,N.jsx)(f.z,{colorScheme:"blue",mr:3,onClick:M,children:ne("csp_census.modal.close")})})]})]}),(0,N.jsx)(_.L,{}),(0,N.jsx)(V.J9,{initialValues:{search:""},onSubmit:ke,children:(0,N.jsx)(V.l0,{children:(0,N.jsx)(V.gN,{name:"search",children:function(e){var n=e.field,r=e.form;return(0,N.jsxs)(w.NI,{isInvalid:r.errors.search&&r.touched.search,children:[(0,N.jsxs)(S.B,{size:"md",children:[(0,N.jsx)(C.I,(0,t.Z)((0,t.Z)({},n),{},{pr:"4.5rem"})),(0,N.jsxs)(y.x,{mr:1,children:[!me&&(0,N.jsx)(f.z,{h:"1.75rem",size:"sm",onClick:r.handleSubmit,colorScheme:"teal",children:(0,N.jsx)(B.W,{boxSize:3,color:"white"})}),me&&(0,N.jsx)(f.z,{h:"1.75rem",size:"sm",onClick:function(){r.resetForm(),Ze()},colorScheme:"teal",children:(0,N.jsx)(F.T,{boxSize:3,color:"white"})})]})]}),(0,N.jsx)(z.J1,{children:r.errors.search})]})}})})})]}),(0,N.jsxs)(T.i,{mt:2,children:[(0,N.jsx)(U.h,{children:(0,N.jsxs)(I.Tr,{children:[(0,N.jsx)(E.Th,{children:ne("csp_census.table.comsumed")}),(0,N.jsx)(E.Th,{children:ne("csp_census.table.data")}),(0,N.jsx)(E.Th,{children:ne("csp_census.table.actions")})]})}),(0,N.jsx)(O.p,{children:he.map((function(n){return(0,N.jsxs)(I.Tr,{children:[(0,N.jsx)(L.Td,{children:n.consumed?(0,N.jsx)(H.n,{color:"green.500"}):""}),(0,N.jsx)(L.Td,{children:n.data}),(0,N.jsx)(L.Td,{children:(0,N.jsxs)(x.k,{justifyContent:"flex-end",children:[(0,N.jsxs)(f.z,{onClick:(t=n.userId,i=n.consumed,(0,c.Z)((0,s.Z)().mark((function n(){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r&&se){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r.cspUserUpdate(se,e,t,{consumed:!i});case 4:be();case 5:case"end":return n.stop()}}),n)})))),mr:1,children:[(0,N.jsx)(P.n,{boxSize:3,color:"blue.500",mr:2}),n.consumed?ne("csp_census.table.set_as_not_voted"):ne("csp_census.table.set_as_voted")]}),(0,N.jsx)(q.h,{"aria-label":"Remove",icon:(0,N.jsx)(R.p,{boxSize:3,color:"red.500"}),onClick:ve(n.userId)})]})})]},n.userId);var t,i}))})]})]})}}}]);